var HISTORY_QUEUE=[],DOCUMENT_TITLE="",CLICK_BY_CODE=!1,CODE_STATE_CHANGE=!1,HISTORY_LIST=[],loadHistorySections=function(){var a=window.location.href,b=History.savedStates,c=b[b.length-2].url,d=a.replace(CURRENT_PATH,""),e=c.replace(CURRENT_PATH,""),f=d.split("/");f[f.length-1]==""&&f.pop();var g=e.split("/");g[g.length-1]==""&&g.pop();for(var h=0;h<f.length;h++){var i=f[h],j=g[h];if(i!=j||h==f.length-1){var k=$("#"+i);CLICK_BY_CODE=!0,k.click();break}}},pageLoadHistorySections=function(){if(HISTORY_QUEUE.length>0){var a=HISTORY_QUEUE.shift(),b=$("#"+a);b.length>0&&(CLICK_BY_CODE=!0,b.click(),HISTORY_QUEUE.length>0&&$(document).ajaxStop(function(){var a=HISTORY_QUEUE[0],b=$("#"+a),c=b.attr("id");typeof c!="undefined"&&(CLICK_BY_CODE=!0,b.click(),a=HISTORY_QUEUE.shift())}))}else ID_CLICK_BY_HISTORY&&$("#"+ID_CLICK_BY_HISTORY).click()};$(document).ready(function(){History.Adapter.bind(window,"statechange",function(){var a=History.getState();CODE_STATE_CHANGE||loadHistorySections(),CODE_STATE_CHANGE=!1}),DOCUMENT_TITLE=document.title,HISTORY_LIST=$.parseJSON(HISTORY);var a=window.location.search;CURRENT_PATH=CURRENT_PATH.replace(a,"");if(HISTORY_LIST){for(var b=0;b<HISTORY_LIST.length;b++){var c="/"+HISTORY_LIST[b]+"/",d=CURRENT_PATH.lastIndexOf(c);d!==-1&&(CURRENT_PATH=CURRENT_PATH.substr(0,d)+"/"+CURRENT_PATH.substr(d+c.length,CURRENT_PATH.length)),HISTORY_QUEUE.push(HISTORY_LIST[b])}while(CURRENT_PATH[CURRENT_PATH.length-1]==="/"&&CURRENT_PATH[CURRENT_PATH.length-2]==="/")CURRENT_PATH=CURRENT_PATH.substring(0,CURRENT_PATH.length-1)}$(".history").live("click",function(){if(CLICK_BY_CODE){var a=History.getState();CLICK_BY_CODE=!1;return}var b=$(this),c=parseInt(b.attr("level")),d=b.attr("id"),e=b.attr("pushes"),f=window.location.href,g=window.location.search;f=f.replace(g,"");var h=f.replace(CURRENT_PATH,""),i=h.split("/"),j=[];for(var k=0;k<i.length;k++){var l=i[k];l.length!=0&&j.push(l)}if(e){var m=[];for(var k=1;k<=e;k++)m[k-1]=b.attr("push"+k)}var n=CURRENT_PATH;for(var k=1;k<c;k++)n=n+j[k-1]+"/";e||(n+=d+"/");if(e)for(var k=0;k<m.length;k++)n+=m[k]+"/";n+=g,CODE_STATE_CHANGE=!0,History.pushState({},DOCUMENT_TITLE,n);return}),pageLoadHistorySections()});